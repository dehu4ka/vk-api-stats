# RT Camera Monitor

Web-портал и инструменты мониторинга камер Ростелеком (RT Camera API).
Цель — контроль качества работы камер: онлайн-статусы, целостность видеоархива, выявление проблем.

## Функционал

### Web-портал (`app.py`)

- **Dashboard** — сводная панель: общее количество камер, онлайн/офлайн с процентами, статус API. Графики: donut online/offline, bar-чарт по вендорам. Таблицы: камеры офлайн дольше всего, проблемы с картами памяти. Auto-refresh каждые 60 сек.
- **Cameras** — список всех камер с фильтрами (поиск по имени/адресу/SN, статус, вендор, ЦОД). Серверная пагинация.
- **Camera Detail** — детальная страница камеры: инфо (UID, SN, MAC, IP, вендор, модель, прошивка), статус онлайн/alive, состояние карты памяти, анализ целостности архива за 90 дней с посуточной разбивкой и визуальными таймлайнами.
- **Archives** — список baked-архивов с фильтром по статусу (NEW/ENQUEUED/ERROR/DONE).

### Excel-отчёт (`report.py`)

Генерация отчёта по целостности архива для всех камер. Многопоточный (8 воркеров), с retry при ошибках API.

Листы в отчёте:
- **TLDR** — одностраничная сводка: общая статистика, распределение по качеству покрытия, топ-10 камер с наихудшим покрытием, наибольшим числом разрывов, самым длинным разрывом.
- **Summary** — все камеры, по строке на камеру: глубина архива, покрытие, фрагменты, разрывы.
- **Daily** — посуточная разбивка: камера + дата + часы записи + покрытие + разрывы.
- **Problems** — только проблемные камеры с указанием причины (низкое покрытие, мелкий архив, длинные разрывы, отсутствие архива).

Цветовая раскраска ячеек: зелёный (>=90%), жёлтый (50-89%), красный (<50%).

## Запуск

```bash
# Активировать виртуальное окружение
source .venv/bin/activate

# Установить зависимости
uv pip install -r requirements.txt

# Запустить веб-портал (development, с debug)
python app.py --debug

# Запустить в production (gunicorn, 0.0.0.0:5000)
gunicorn -b 0.0.0.0:5000 "app:create_app()"

# Сгенерировать Excel-отчёт
python report.py
# → report_YYYY-MM-DD_HHMMSS.xlsx
```

## Конфигурация

API-ключ задаётся в файле `.env`:

```
API_KEY=your_api_key_here
```
